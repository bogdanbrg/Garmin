version: 2

models:
  - name: gear_overview
    description: |
      Complete overview of all gear with usage statistics and lifecycle metrics.
      This is the primary analytics table combining gear details with cumulative usage data.
      Includes derived metrics like percentage of maximum distance used and remaining gear life.
    columns:
      - name: gear_id
        description: Unique identifier for each piece of gear (UUID from Garmin)
        data_tests:
          - unique
          - not_null
      
      - name: gear_type
        description: Type of gear (e.g., shoes, bike, etc.)
        data_tests:
          - not_null
      
      - name: gear_name
        description: Custom name or model description for the gear
      
      - name: status
        description: Current status of the gear (active or retired)
        data_tests:
          - accepted_values:
              values: ['active', 'retired']
      
      - name: start_date
        description: Date when the gear was first used (YYYY-MM-DD format)
        data_tests:
          - not_null
      
      - name: end_date
        description: Date when the gear was retired (NULL if still active)
      
      - name: stats_last_updated
        description: Last date when usage statistics were updated from Garmin
      
      - name: total_distance_km
        description: Cumulative distance traveled with this gear in kilometers
        data_tests:
          - not_null
      
      - name: total_activities
        description: Total number of activities recorded with this gear
        data_tests:
          - not_null
      
      - name: max_distance_km
        description: Maximum recommended distance in kilometers before gear retirement (NULL for gear without distance limits)
      
      - name: pct_of_max_distance_used
        description: Percentage of maximum recommended distance already used (NULL if no max distance defined)
      
      - name: remaining_distance_km
        description: Estimated kilometers remaining before retirement recommendation (NULL if no max distance defined)
      
      - name: days_since_first_use
        description: Number of days since the gear was first used
        data_tests:
          - not_null
      
      - name: dbt_loaded_at
        description: Timestamp when dbt processed this record

  - name: activity_summary
    description: |
      Activity summary table with weather and gear context.
      This mart uses the intermediate layer (int_activities_enriched) to provide
      a clean, business-ready view of activity performance including environmental conditions.
    columns:
      - name: activity_id
        description: Unique identifier for each activity
        data_tests:
          - unique
          - not_null

      - name: activity_name
        description: User-provided name for the activity

      - name: activity_type_key
        description: Type of activity (e.g., running, cycling)

      - name: start_date
        description: Date when the activity started
        data_tests:
          - not_null

      - name: distance_km
        description: Total distance covered in kilometers
        data_tests:
          - not_null

      - name: duration_minutes
        description: Total duration of the activity in minutes

      - name: avg_speed_kmh
        description: Average speed in kilometers per hour

      - name: total_calories
        description: Total calories burned during the activity

      - name: distance_category
        description: Categorized distance range (e.g., '5K-10K', '10K-15K', '20K+')
        data_tests:
          - not_null
          - accepted_values:
              values: ['Short Run', '1K-5K', '5K-10K', '10K-15K', '15K-20K', '20K+']

      - name: temperature_category
        description: Temperature condition category (Hot, Moderate, Cool, Cold)
        data_tests:
          - accepted_values:
              values: ['Hot', 'Moderate', 'Cool', 'Cold']

      - name: weather_condition
        description: Weather condition during the activity

      - name: gear_name
        description: Name of the gear used for this activity